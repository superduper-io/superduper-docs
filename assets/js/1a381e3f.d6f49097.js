"use strict";(self.webpackChunknewdocs=self.webpackChunknewdocs||[]).push([[6961],{9209:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>a});var d=s(4848),t=s(8453);const r={},c="Execute",i={id:"core_api/execute",title:"Execute",description:"superduper allows developers to build their functionality on document-stores as well as SQL databases.",source:"@site/versioned_docs/version-0.7/core_api/execute.md",sourceDirName:"core_api",slug:"/core_api/execute",permalink:"/docs/core_api/execute",draft:!1,unlisted:!1,editUrl:"https://github.com/superduper-io/superduper/edit/main/docs/versioned_docs/version-0.7/core_api/execute.md",tags:[],version:"0.7",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Apply",permalink:"/docs/core_api/apply"},next:{title:"Package",permalink:"/docs/core_api/package"}},l={},a=[{value:"Selects",id:"selects",level:3},{value:"Vector search",id:"vector-search",level:3},{value:"Insert",id:"insert",level:3},{value:"Update",id:"update",level:3},{value:"Delete",id:"delete",level:3}];function o(e){const n={code:"code",em:"em",h1:"h1",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.h1,{id:"execute",children:"Execute"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"superduper"})," allows developers to build their functionality on document-stores as well as SQL databases.\nTo enable portability, it includes it's own simple query abstraction, which wraps the ",(0,d.jsx)(n.code,{children:"db.databackend"})," native queries.\nQueries are built using a compositional syntax similar to that used by ",(0,d.jsx)(n.code,{children:"pandas"})," and ",(0,d.jsx)(n.code,{children:"ibis"}),". The API also includes extensions of this paradigm to cover vector-searches."]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"superduper"})," supports:"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Inserts"}),"\n",(0,d.jsx)(n.li,{children:"Selects"}),"\n",(0,d.jsx)(n.li,{children:"Updates"}),"\n",(0,d.jsx)(n.li,{children:"Deletes"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"In addition hybrid queries involving a combination of vector-search and filtering are supported:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Vector-search queries"}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"selects",children:"Selects"}),"\n",(0,d.jsx)(n.p,{children:'All select queries consist of a "chain" of methods executed over a base table.'}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"q = db['<table_name>'].method_1(*args_1, **kwargs_1).method_2(*args_2, **kwargs_2)....\n"})}),"\n",(0,d.jsxs)(n.p,{children:["Select queries can be passed around as objects, and are lazily executed with ",(0,d.jsx)(n.code,{children:".execute()"})," and ",(0,d.jsx)(n.code,{children:".get(...)"}),".\nThey play a role in certain ",(0,d.jsx)(n.code,{children:"Component"})," implementations such as ",(0,d.jsx)(n.code,{children:"Listener"})," and ",(0,d.jsx)(n.code,{children:"VectorIndex"}),". Developers\nmay incorporate select queries as associated data in their own custom ",(0,d.jsx)(n.code,{children:"Component"})," implementations."]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:(0,d.jsx)(n.strong,{children:"Table select"})})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"# All data\ndata = db['<table>'].execute()\n\n# One datapoint\nr = db['<table>'].get()\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:(0,d.jsx)(n.strong,{children:"Select columns/ fields"})})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"data = db['<table>'].select('x', 'y').execute()\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:(0,d.jsx)(n.strong,{children:"Select rows"})})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"t = db['<table>']\ndata = t.filter(t['x'] > 2).execute()\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:(0,d.jsx)(n.strong,{children:"Select rows and columns"})})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"t = db['<table>']\ndata = t.filter(t['x'] > 2).select('x', 'y').execute()\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:(0,d.jsxs)(n.strong,{children:["Get outputs of one or more ",(0,d.jsx)(n.code,{children:"Listener"})," instances"]})})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"listener_1 = db.load('Listener', '<listener_1>')\nlistener_2 = db.load('Listener', '<listener_2>')\n\njoined_outputs_1 = db['<table>'].outputs(listener_1.predict_id).execute()\njoined_both_outputs = db['<table>'].outputs(listener_1.predict_id, listener_2.predict_id).execute()\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:(0,d.jsx)(n.strong,{children:"Get the ids of a query"})})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"ids = query.ids()   # Any select query\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:(0,d.jsx)(n.strong,{children:"Get the distinct values of a column"})})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"distinct_x = query.distinct('x')   # Any select query\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:(0,d.jsx)(n.strong,{children:"Restrict the range of a query to certain primary ids"})})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"data = query.subset(ids)\n"})}),"\n",(0,d.jsx)(n.h3,{id:"vector-search",children:"Vector search"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:(0,d.jsx)(n.strong,{children:"Vanilla vector-search"})})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"db['<table_name>'].like({'<key>': <value>}, vector_index='<vector_index>', n=<n>).execute()\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:(0,d.jsx)(n.strong,{children:"Pre-filtered"})})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"t = db['<table_name>']\ncondition = t['<key>'] == <value>   # ==, <=, >=\n\nt.filter(condition).like({'<key>': <value>}, vector_index='<vector_index>', n=<n>).execute()\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:(0,d.jsx)(n.strong,{children:"Post-filtered"})})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"t.like({'<key>': <value>}, vector_index='<vector_index>', n=<n>).filter(condition).execute()\n"})}),"\n",(0,d.jsx)(n.h3,{id:"insert",children:"Insert"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"superduper"})," supports inserting data which is a combination of JSON-native content,\nand objects which need to be serialized as ",(0,d.jsx)(n.code,{children:"bytes"})," using a Python based serialized (e.g.\n",(0,d.jsx)(n.code,{children:"pickle"}),", ",(0,d.jsx)(n.code,{children:"dill"})," or a custom serializer)."]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"superduper"})," has a typing system which is un-pedantic, doing the minimum necessary\nto get content saved in the ",(0,d.jsx)(n.code,{children:"db.databackend"}),"."]}),"\n",(0,d.jsxs)(n.p,{children:["Inserting data is possible in two ways, either by creating a table with typed fields,\nor by created a ",(0,d.jsx)(n.code,{children:"superduper.base.Base"})," class with type annotations:"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:(0,d.jsx)(n.strong,{children:"Available datatypes"})})}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Name"}),(0,d.jsx)(n.th,{children:"Description"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"str"})}),(0,d.jsx)(n.td,{children:"Python string"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"int"})}),(0,d.jsx)(n.td,{children:"Python integer"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"float"})}),(0,d.jsx)(n.td,{children:"Python float"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"bool"})}),(0,d.jsx)(n.td,{children:"Python boolean"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"json"})}),(0,d.jsxs)(n.td,{children:["JSON-able objects (",(0,d.jsx)(n.code,{children:"list"}),", ",(0,d.jsx)(n.code,{children:"dict"}),")"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"dillencoder"})}),(0,d.jsxs)(n.td,{children:["Save content in ",(0,d.jsx)(n.code,{children:"db.databackend"})," base64 encoded"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"dill"})}),(0,d.jsxs)(n.td,{children:["Save content as bytes in ",(0,d.jsx)(n.code,{children:"db.artifact_store"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"file"})}),(0,d.jsxs)(n.td,{children:["Save reference as a file in ",(0,d.jsx)(n.code,{children:"db.artifact_store"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"package.module.variable_name"})}),(0,d.jsxs)(n.td,{children:["Custom datatype implementing ",(0,d.jsx)(n.code,{children:"superduper.base.datatype.BaseDatatype"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"basetype"})}),(0,d.jsxs)(n.td,{children:["Indicates a ",(0,d.jsx)(n.code,{children:"superduper.base.Base"})," class"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"componenttype"})}),(0,d.jsxs)(n.td,{children:["Indicates a ",(0,d.jsx)(n.code,{children:"superduper.components.component.Component"})," type"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"componentdict"})}),(0,d.jsxs)(n.td,{children:["A dictionary ",(0,d.jsx)(n.code,{children:"str -> Component"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"componentlist"})}),(0,d.jsxs)(n.td,{children:["A list of ",(0,d.jsx)(n.code,{children:"Component"})]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"vector[float:32]"})}),(0,d.jsxs)(n.td,{children:["A searchable ",(0,d.jsx)(n.code,{children:"numpy.array"})," with datatype and shape"]})]})]})]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:(0,d.jsxs)(n.strong,{children:["Create a ",(0,d.jsx)(n.code,{children:"Table"})," with typed columns"]})})}),"\n",(0,d.jsx)(n.p,{children:"Example data:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"import PIL.Image\n\ndata = [\n    {'x': 'test', 'y': 1, 'z': PIL.Image.open('my_image_1.png')},\n    {'x': 'test', 'y': 2, 'z': PIL.Image.open('my_image_2.png')}\n]\n"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"db.apply(\n    Table(\n        'documents',\n        fields={'x': 'str', 'y': 'int', 'z': 'dill'}\n    )\n)\n\nq = db['documents'].insert(data)\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.em,{children:(0,d.jsxs)(n.strong,{children:["Create an implicit ",(0,d.jsx)(n.code,{children:"Table"})," and typed columns with a ",(0,d.jsx)(n.code,{children:"Base"})," subclass"]})})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"from superduper.base.Base\n\nclass documents(Base):\n    x: str\n    y: int\n    z: t.Any\n\ndb.insert(\n    documents(x=r['x'], y=r['y'], z=r['z'])\n    for r in data\n)\n"})}),"\n",(0,d.jsx)(n.h3,{id:"update",children:"Update"}),"\n",(0,d.jsxs)(n.p,{children:["Update the table where the values in ",(0,d.jsx)(n.code,{children:"kwargs"})," apply:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"db['<table_name>'].update(**kwargs)\n"})}),"\n",(0,d.jsx)(n.h3,{id:"delete",children:"Delete"}),"\n",(0,d.jsxs)(n.p,{children:["Delete rows from the table where the values in ",(0,d.jsx)(n.code,{children:"kwargs"})," apply:"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:"db['<table_name>'].delete(**kwargs)\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>i});var d=s(6540);const t={},r=d.createContext(t);function c(e){const n=d.useContext(r);return d.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),d.createElement(r.Provider,{value:n},e.children)}}}]);